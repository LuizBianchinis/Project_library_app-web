<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conta Usuário</title>
    <link rel="stylesheet" href="/css/conta.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <script src="https://cdn.lordicon.com/ritcuqlt.js"></script>
</head>
<body>
    <nav class="menu-lateral">
        <div class="btn-expandir">
            <i class="bi bi-list" id="btn-exp"></i>
        </div><!--btn-expandir-->
        <ul>
            <li class="item-menu">
                <a href="inicial_user.html">
                    <span class="icon"><i class="bi bi-house-door"></i></span>
                    <span class="txt-link">Início</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="carinho.html">
                    <span class="icon"><i class="bi bi-bag"></i></span>
                    <span class="txt-link">Carinho</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="meus_livros.html">
                    <span class="icon"><i class="bi bi-book"></i></span>
                    <span class="txt-link">Meus livros</span>
                </a>
            </li>
            <li class="item-menu ativo">
                <a href="conta_user.html">
                    <span class="icon"><i class="bi bi-person-circle"></i></span>
                    <span class="txt-link">Conta</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="login.html" id="logout-link" onclick="logout(event)">
                    <span class="icon"><i class="bi bi-box-arrow-left"></i></span>
                    <span class="txt-link">Sair</span>
                </a>
            </li>
        </ul>
    </nav>

    <div class="dados-usuario-wrapper">
        <h2>Dados do Usuário</h2>
        <form id="dadosUsuarioForm">
            <div class="form-group">
                <label for="first_name">Primeiro Nome</label>
                <input type="text" id="first_name" name="first_name" readonly>
            </div>
            <div class="form-group">
                <label for="last_name">Sobrenome</label>
                <input type="text" id="last_name" name="last_name" readonly>
            </div>
            <div class="form-group">
                <label for="cellphone">Celular</label>
                <input type="tel" id="cellphone" name="cellphone" readonly>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" readonly>
            </div>
            <div class="form-group">
                <label for="password">Senha</label>
                <input type="text" id="password" name="password" readonly>
            </div>
            <div class="form-group">
                <label for="birth_date">Data de Nascimento</label>
                <input type="date" id="birth_date" name="birth_date" readonly>
            </div>
            <div class="form-group">
                <label for="city">Cidade</label>
                <input type="text" id="city" name="city" readonly>
            </div>
            <div class="form-group">
                <label for="zip_code">CEP</label>
                <input type="text" id="zip_code" name="zip_code" readonly>
            </div>
            <div class="form-group">
                <label for="address">Endereço</label>
                <textarea id="address" name="address" rows="2" readonly></textarea>
            </div>
            <div class="form-group">
                <label for="number">Numero</label>
                <textarea id="text" name="number" rows="2" readonly></textarea>
            </div>
        </form>
    </div>
    <script>
    
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
        }
    
        document.addEventListener("DOMContentLoaded", function() {
            fetch('http://127.0.0.1:5000/v1/', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('first_name').value = data.first_name;
                document.getElementById('last_name').value = data.last_name;
                document.getElementById('cellphone').value = data.cellphone;
                document.getElementById('email').value = data.email;
                document.getElementById('password').value = data.password;
                document.getElementById('birth_date').value = data.birth_date;
                document.getElementById('city').value = data.city;
                document.getElementById('zip_code').value = data.zip_code;
                document.getElementById('address').value = data.address;
                document.getElementById('number').value = data.number;
            })
            .catch(error => console.error('Error:', error));
        });

        function enableEditing() {
            document.querySelectorAll('#dadosUsuarioForm input, #dadosUsuarioForm textarea').forEach(input => {
                input.removeAttribute('readonly');
            });
        }

        document.getElementById('dadosUsuarioForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const data = {
                id_user: 'current_user_id', // Assumindo que você tenha o ID do usuário armazenado de alguma forma
                first_name: document.getElementById('first_name').value,
                last_name: document.getElementById('last_name').value,
                cellphone: document.getElementById('cellphone').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                birth_date: document.getElementById('birth_date').value,
                city: document.getElementById('city').value,
                zip_code: document.getElementById('zip_code').value,
                address: document.getElementById('address').value,
                number: document.getElementById('number').value
            };

            fetch('/update', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                alert('Dados atualizados com sucesso!');
                location.reload(); // Recarrega a página para desativar a edição e atualizar os dados
            })
            .catch(error => console.error('Error:', error));
        });
  
    </script>
</body>